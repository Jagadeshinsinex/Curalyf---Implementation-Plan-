<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Curalyf - Implementation Plan</title>
    <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/mermaid/dist/mermaid.min.js"></script>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, 'Open Sans', 'Helvetica Neue', sans-serif;
            line-height: 1.6;
            color: #333;
            max-width: 900px;
            margin: 0 auto;
            padding: 2rem;
            background: #fdfdfd;
        }
        h1, h2, h3 { color: #1a1a1a; margin-top: 1.5em; }
        h1 { border-bottom: 2px solid #eaeaea; padding-bottom: 0.3em; }
        h2 { border-bottom: 1px solid #eaeaea; padding-bottom: 0.3em; }
        code { background: #f6f8fa; padding: 0.2em 0.4em; border-radius: 3px; font-family: monospace; }
        pre { background: #f6f8fa; padding: 1rem; border-radius: 6px; overflow-x: auto; }
        .mermaid { text-align: center; margin: 2rem 0; }
        blockquote { border-left: 4px solid #dfe2e5; margin: 0; padding-left: 1rem; color: #6a737d; }
    </style>
</head>
<body>
    <div id="content"></div>

    <script>
        const markdown = `# Curalyf - Comprehensive System Design & Implementation Plan

## 1. Executive Summary

### Problem Statement
Patients—especially those with chronic illnesses—face a "care cliff" after hospital discharge. Features like fragmented health records, confusing prescriptions, and lack of professional oversight lead to poor medication adherence and missed emergency warning signs. Doctors currently lack visibility into patient status between visits.

### Solution: Curalyf Phase 1
A unified patient-support platform bridging hospital and home care.
- **For Patients**: A mobile-responsive web app for managing medications, tracking vitals, and receiving automated safety guidance (missed dose/emergency rules).
- **For Doctors**: A desktop dashboard to monitor patient adherence, viewing trends, and receiving alerts for at-risk patients.

---

## 2. Technology Stack

- **Frontend Framework**: Next.js 16 (React 19) - *Performance & SEO*
- **Styling**: Tailwind CSS v4 - *Utility-first styling*
- **Language**: TypeScript - *Type safety & maintainability*
- **Icons**: Lucide React - *Consistent UI iconography*
- **Backend (Proposed)**: Supabase (PostgreSQL)
  - **Auth**: Built-in Row Level Security (RLS) for privacy.
  - **Database**: Relational data model for complex health data.
  - **Realtime**: For immediate emergency alerts.
- **State Management**: React Query / Server Actions.
- **Diagramming**: Mermaid.js (for documentation).

---

## 3. Database Schema Design (Supabase/PostgreSQL)

We will use a relational schema to ensure data integrity.

### Core Tables
1.  **\`profiles\`**:
    - \`id\` (UUID, PK) -> references \`auth.users\`
    - \`role\` (enum: 'patient', 'doctor')
    - \`full_name\`
    - \`abha_id\` (optional, for future integration)
    - \`avatar_url\`

2.  **\`medications\`** (Prescriptions):
    - \`id\` (UUID, PK)
    - \`patient_id\` (FK -> profiles)
    - \`prescribed_by\` (FK -> profiles, doctor)
    - \`drug_name\`
    - \`dosage\` (e.g., "500mg")
    - \`frequency\` (e.g., "BID", "QD")
    - \`start_date\`, \`end_date\`

3.  **\`schedules\`** (Daily derived doses):
    - \`id\` (UUID, PK)
    - \`medication_id\` (FK)
    - \`scheduled_time\` (TIME)
    - \`day_of_week\` (Array, e.g., ["Mon", "Tue"...])

4.  **\`adherence_logs\`** (Tracking):
    - \`id\` (UUID, PK)
    - \`schedule_id\` (FK)
    - \`status\` (enum: 'taken', 'missed', 'skipped')
    - \`taken_at\` (TIMESTAMP)
    - \`notes\` (TEXT)

5.  **\`vitals_logs\`**:
    - \`id\` (UUID, PK)
    - \`patient_id\` (FK)
    - \`type\` (enum: 'bp', 'hr', 'glucose', 'temp')
    - \`value\` (JSON/Text, e.g. "120/80")
    - \`recorded_at\` (TIMESTAMP)
    - \`severity\` (enum: 'normal', 'warning', 'critical')

---

## 4. User Flows

### A. Medication Adherence Loop
<div class="mermaid">
graph TD
    A[Patient Login] --> B{Check Schedule}
    B -- Time for Meds --> C[Notification/Prompt]
    C --> D{User Action}
    D -- Take --> E[Log: Taken]
    D -- Skip --> F[Ask Reason] --> G[Log: Skipped + Reason]
    D -- Miss Timeout --> H[Rule Engine Triggered]
    H --> I[Guidance: Take Now or Skip?]
    I --> J[Log: Missed]
    E & G & J --> K[Update Doctor Dashboard]
</div>

### B. Emergency & Vitals Loop
<div class="mermaid">
graph TD
    A[Patient Inputs Vitals] --> B{Rule Engine Check}
    B -- Normal --> C[Log & Show 'Good']
    B -- Warning --> D[Show Guidance e.g., 'Rest & Retest']
    B -- Critical --> E[Trigger Emergency Protocol]
    E --> F[Show SOS Screen]
    E --> G[Alert Doctor/Emergency Contact]
</div>

---

## 5. UI/UX & Dashboards

### Patient View (Mobile First)
1.  **Home / Today's Schedule**:
    - A vertical timeline showing meds for the day.
    - Large, easy-to-tap cards: "Metformin - 8:00 AM".
    - Swipe actions or big buttons for "Taken".
    - **SOS Button**: Floating Action Button (FAB) always visible for emergencies.
2.  **Vitals Entry**:
    - Simple forms with large inputs for BP, Sugar.
3.  **History**:
    - Calendar view of past adherence.

### Doctor View (Desktop Optimized)
1.  **Patient Overview (The "Control Tower")**:
    - Table of assigned patients.
    - **Columns**: Name, Last Active, Adherence Score (%), Last Vitals, Status (Green/Yellow/Red).
    - Sorting by "Risk Level" to prioritize attention.
2.  **Patient Detail**:
    - **Header**: Demographics & Allergies.
    - **Adherence Chart**: Heatmap of doses taken vs. missed.
    - **Visual Trends**: Line charts for BP/Glucose over time.
    - **Action**: "Send Message" or "Adjust Prescription".

---

## 6. Implementation Steps (A-Z)

### Phase 1: Foundation (Done)
- [x] Project Init (Next.js 16, Tailwind, TypeScript)
- [x] Landing Page & Branding

### Phase 2: Database & Auth (Backend)
- [ ] Set up Supabase project.
- [ ] Create Tables (\`profiles\`, \`medications\` etc).
- [ ] Implement Sign Up/Login flows with RLS policies.

### Phase 3: Patient Features (Frontend)
- [ ] **Dashboard**: Build the timeline component.
- [ ] **Interactions**: Connect "Take" button to DB.
- [ ] **Vitals**: Create input forms with basic validation logic.
- [ ] **SOS**: implement the emergency overlay.
`;

        document.getElementById('content').innerHTML = marked.parse(markdown);
        mermaid.initialize({ startOnLoad: true, theme: 'default' });
    </script>
</body>
</html>`;
